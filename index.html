<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Циклическая Карусель</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #f0f0f0;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .carousel {
      position: relative;
      width: 90%;
      max-width: 400px;
      height: 600px;
      perspective: 1000px;
      overflow: hidden;
    }
    .card {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 20px;
      background-size: cover;
      background-position: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease, opacity 0.3s ease;
      touch-action: pan-y;
    }
    /* Начальные стили для эффекта «колоды» */
    .card.top {
      z-index: 3;
      transform: translateX(0) scale(1) translateY(0);
    }
    .card.middle {
      z-index: 2;
      transform: scale(0.95) translateY(10px);
    }
    .card.bottom {
      z-index: 1;
      transform: scale(0.90) translateY(20px);
    }
  </style>
</head>
<body>
  <div class="carousel"></div>

  <script>
    // Массив изображений (можно добавить больше)
    const images = [
      'ily.JPG',
      'ily.JPG',
      'ily.JPG',
      'ily.JPG',
      'ily.JPG'
    ];

    let currentIndex = 0; // индекс для отображаемой в данный момент карточки
    const carousel = document.querySelector('.carousel');
    const threshold = 100;
    let startX = 0;
    let isDragging = false;

    // Создаём 3 карточки
    const cardElements = [];
    for (let i = 0; i < 3; i++) {
      const card = document.createElement('div');
      card.classList.add('card');
      carousel.appendChild(card);
      cardElements.push(card);
    }

    // Обновление отображения карточек согласно currentIndex
    function renderDeck() {
      // Карточки: верхняя – текущая, middle – следующая, bottom – через одну
      const topImg = images[currentIndex % images.length];
      const middleImg = images[(currentIndex + 1) % images.length];
      const bottomImg = images[(currentIndex + 2) % images.length];
      cardElements[0].style.backgroundImage = `url('${topImg}')`;
      cardElements[1].style.backgroundImage = `url('${middleImg}')`;
      cardElements[2].style.backgroundImage = `url('${bottomImg}')`;

      // Назначаем классы для стилизации
      cardElements[0].className = 'card top';
      cardElements[1].className = 'card middle';
      cardElements[2].className = 'card bottom';

      // Назначаем обработчики свайпов только для верхней карточки
      attachSwipe(cardElements[0]);
    }

    // Функция назначения обработчиков для свайпа (на верхнюю карточку)
    function attachSwipe(card) {
      card.addEventListener('touchstart', onTouchStart);
      card.addEventListener('touchmove', onTouchMove);
      card.addEventListener('touchend', onTouchEnd);
    }

    function onTouchStart(e) {
      startX = e.touches[0].clientX;
      isDragging = true;
      this.style.transition = 'none';
    }

    function onTouchMove(e) {
      if (!isDragging) return;
      const moveX = e.touches[0].clientX - startX;
      this.style.transform = `translateX(${moveX}px) rotate(${moveX / 10}deg)`;
    }

    function onTouchEnd(e) {
      isDragging = false;
      const moveX = e.changedTouches[0].clientX - startX;
      // Свайп влево → следующий элемент, вправо → предыдущий
      if (moveX < -threshold) {
        swipeNext(this, moveX);
      } else if (moveX > threshold) {
        swipePrev(this, moveX);
      } else {
        // Возврат в исходное положение
        this.style.transition = 'transform 0.3s ease';
        this.style.transform = 'translateX(0) rotate(0deg)';
      }
    }

    // Переход к следующей карточке
    function swipeNext(card) {
      card.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
      card.style.transform = 'translateX(-1000px) rotate(-30deg)';
      card.style.opacity = 0;
      setTimeout(() => {
        // Увеличиваем индекс и рендерим колоду заново
        currentIndex = (currentIndex + 1) % images.length;
        // Переставляем карточки: верхняя перемещается в конец массива
        cardElements.push(cardElements.shift());
        renderDeck();
      }, 300);
    }

    // Переход к предыдущей карточке
    function swipePrev(card) {
      card.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
      card.style.transform = 'translateX(1000px) rotate(30deg)';
      card.style.opacity = 0;
      setTimeout(() => {
        // Переходим к предыдущему изображению
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        // Переставляем карточки: последний элемент переносим в начало массива
        cardElements.unshift(cardElements.pop());
        renderDeck();
      }, 300);
    }

    // Инициализация колоды
    renderDeck();
  </script>
</body>
</html>
